<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LIFF Flex Share + Generator</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background-image: url("https://img2.pic.in.th/IMG_0784.jpeg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
    }
    .container {
      background: rgba(0, 0, 0, 0.6);
      padding: 24px;
      border-radius: 12px;
      width: 90%;
      max-width: 420px;
      margin-top: 80px;
      color: #fff;
      text-align: center;
    }
    input {
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      margin-bottom: 16px;
    }
    button {
      width: 100%;
      font-size: 18px;
      padding: 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      margin-bottom: 14px;
    }
    button:active { transform: scale(0.96); }
    hr { margin: 18px 0; opacity: 0.3; }
  </style>
</head>
<body>

<div class="container">
  <h2 id="username">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...</h2>

  <!-- ‡πÅ‡∏ä‡∏£‡πå Flex ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
  <button onclick="shareFlex1()">‡πÅ‡∏ä‡∏£‡πå Flex1 üòç</button>
  <button onclick="shareFlex2()">‡πÅ‡∏ä‡∏£‡πå Flex2 üî•</button>

  <hr/>

  <!-- Generator (‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏° whitelist) -->
  <div id="generatorSection" style="display:none;">
    <input id="genInput" placeholder="‡∏ß‡∏≤‡∏á: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ LINE ID" />
    <button id="genBtn" onclick="generateAndShare()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏£‡πå Flex üöÄ</button>
  </div>
</div>

<script>
// ====== WHITELIST ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏Å‡πâ userId ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏≠‡∏á) ======
const whitelistUsers = [
  { name: "ü•Ä‚ö°üñ§‚û£‡ªÇ„ÅÆ·Äî·Äê’É‡∏±‡πà’Å¬π‚úØüñ§‚ö°ü•Ä", userId: "u72d702258991428344e77670bb76f80a" } // üëà ‡πÅ‡∏Å‡πâ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á
];

// ====== FLEX1 ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á/‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ) ======
const flex1 = {
  "type": "flex",
  "altText": "‡∏£‡∏±‡∏ö ‡πÇ‡∏û‡∏™ ‡πÅ‡∏ä‡∏£‡πå ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏£‡∏π‡∏õ",
  "contents": {
    "type": "bubble",
    "size": "giga",
    "body": {
      "type": "box",
      "layout": "vertical",
      "contents": [
        {
          "type": "text",
          "text": "‡∏£‡∏∞‡∏ö‡∏ö PYTHON  AUTOPOST",
          "color": "#ffffff",
          "wrap": true,
          "align": "center",
          "weight": "bold",
          "size": "xl"
        }
      ],
      "backgroundColor": "#000000"
    },
    "footer": {
      "type": "box",
      "layout": "vertical",
      "spacing": "sm",
      "backgroundColor": "#99ffff",
      "contents": [
        { "type": "button", "style": "primary", "height": "sm", "offsetTop": "sm",
          "action": { "type": "uri", "label": "‡πÇ‡∏û‡∏™‡∏£‡∏π‡∏õ FLEX MESSAGE", "uri": "http://line.me/ti/p/~mc357.com" } },
        { "type": "button", "style": "primary", "height": "sm", "offsetTop": "sm",
          "action": { "type": "uri", "label": "‡∏£‡∏∞‡∏ö‡∏ö ‡πÇ‡∏û‡∏™‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°", "uri": "http://line.me/ti/p/~mc357.com" } },
        { "type": "button", "style": "primary", "height": "sm", "offsetTop": "sm",
          "action": { "type": "uri", "label": "‡∏£‡∏∞‡∏ö‡∏ö ‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏û‡∏™‡∏à‡∏≤‡∏Å VOOM", "uri": "http://line.me/ti/p/~mc357.com" } },
        { "type": "button", "style": "primary", "height": "sm", "offsetTop": "sm",
          "action": { "type": "uri", "label": "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö AUTO ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏≠‡∏á", "uri": "http://line.me/ti/p/~mc357.com" } },
        { "type": "button", "style": "primary", "height": "sm", "offsetTop": "sm",
          "action": { "type": "uri", "label": "‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ñ‡∏π‡∏Å‡∏™‡∏∏‡∏î‡πÜ", "uri": "http://line.me/ti/p/~mc357.com" } }
      ]
    }
  }
};

// ====== FLEX2 ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á/‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ) ======
const flex2 = {
  "type": "flex",
  "altText": "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤",
  "contents": {
    "type": "bubble",
    "size": "giga",
    "hero": {
      "type": "image",
      "url": "https://img2.pic.in.th/IMG_0784.jpeg",
      "size": "full",
      "aspectRatio": "2:3",
      "aspectMode": "cover",
      "action": { "type": "uri", "uri": "http://line.me/ti/p/~mc357.com" },
      "backgroundColor": "#000000"
    },
    "footer": {
      "type": "box",
      "layout": "vertical",
      "spacing": "sm",
      "contents": [
        { "type": "button", "style": "primary", "height": "sm",
          "action": { "type": "uri", "label": "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏Ñ‡∏•‡∏¥‡∏Å!!!", "uri": "http://line.me/ti/p/~mc357.com" } }
      ],
      "flex": 0,
      "backgroundColor": "#000000"
    }
  }
};

// ====== INIT LIFF + ‡πÄ‡∏ä‡πá‡∏Ñ whitelist ======
liff.init({ liffId: "2008621627-1eN2VA2x" })
  .then(async () => {
    const profile = await liff.getProfile();
    document.getElementById("username").innerText = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${profile.displayName} üòä`;

    const isAllowed = whitelistUsers.some(
      user => user.name === profile.displayName && user.userId === profile.userId
    );

    if (isAllowed) {
      document.getElementById("generatorSection").style.display = "block";
    } else {
      document.getElementById("generatorSection").style.display = "none";
      console.warn("User not in whitelist");
    }
  })
  .catch(err => {
    console.error("LIFF init error", err);
    document.getElementById("username").innerText = "‚ùå LIFF ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
  });

// ====== ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå Flex1 / Flex2 ======
async function shareFlex1() {
  if (!liff.isInClient()) { alert("‚ö† ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"); return; }
  await liff.shareTargetPicker([flex1]);
}

async function shareFlex2() {
  if (!liff.isInClient()) { alert("‚ö† ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"); return; }
  await liff.shareTargetPicker([flex2]);
}

// ====== Generator ‡πÅ‡∏ä‡∏£‡πå Flex ‡∏à‡∏≤‡∏Å input 1 ‡∏ä‡πà‡∏≠‡∏á ======
async function generateAndShare() {
  const input = document.getElementById("genInput").value.trim();
  if (!input.includes(" ")) {
    alert("‚ö† ‡πÉ‡∏™‡πà: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ LINE ID");
    return;
  }

  const [imageUrl, lineId] = input.split(" ", 2);

  const flexCarousel = {
    "type": "flex",
    "altText": "Flex Generator",
    "contents": {
      "type": "carousel",
      "contents": [
        {
          "type": "bubble",
          "size": "giga",
          "hero": {
            "type": "image",
            "url": imageUrl,
            "size": "full",
            "aspectRatio": "2:3",
            "aspectMode": "cover",
            "action": { "type": "uri", "uri": `http://line.me/ti/p/~${lineId}` },
            "backgroundColor": "#000000"
          },
          "footer": {
            "type": "box",
            "layout": "vertical",
            "spacing": "sm",
            "backgroundColor": "#000000",
            "contents": [
              {
                "type": "button",
                "style": "primary",
                "height": "sm",
                "action": {
                  "type": "uri",
                  "label": "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏Ñ‡∏•‡∏¥‡∏Å!!!",
                  "uri": `http://line.me/ti/p/~${lineId}`
                }
              }
            ]
          }
        }
      ]
    }
  };

  if (!liff.isInClient()) { alert("‚ö† ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"); return; }

  try {
    await liff.shareTargetPicker([flexCarousel]);
    alert("‚ú® ‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
  } catch (e) {
    console.error(e);
    alert("‚ùå ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }
}
</script>

</body>
</html>