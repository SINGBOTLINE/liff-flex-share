<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LIFF Flex Share + Access Control</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body {
  margin:0; padding:0; height:100vh;
  background-image:url("https://img2.pic.in.th/IMG_0784.jpeg");
  background-size:cover; background-position:center;
  font-family:sans-serif; display:flex; justify-content:center;
}
.container {
  background:rgba(0,0,0,0.6); padding:24px; border-radius:12px;
  width:90%; max-width:420px; margin-top:70px; color:#fff; text-align:center;
}
input{width:100%;padding:14px;border-radius:8px;border:none;font-size:16px;margin-bottom:16px;}
button{width:100%;font-size:18px;padding:14px;border-radius:8px;border:none;cursor:pointer;margin-bottom:14px;}
button:active{transform:scale(0.96);}
hr{margin:18px 0;opacity:0.3;}
</style>
</head>
<body>

<div class="container">
  <h2 id="username">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...</h2>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå Flex ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
  <button id="btnFlex1" onclick="shareFlex1()">‡πÅ‡∏ä‡∏£‡πå Flex1 üòç</button>
  <button id="btnFlex2" onclick="shareFlex2()">‡πÅ‡∏ä‡∏£‡πå Flex2 üî•</button>

  <hr/>

  <!-- UI ‡πÄ‡∏û‡∏¥‡πà‡∏° Flex ‡∏ï‡∏≤‡∏° userId -->
  <input id="flexJsonInput" placeholder="‡∏ß‡∏≤‡∏á Flex JSON"/>
  <input id="flexUserIdInput" placeholder="‡πÉ‡∏™‡πà userId ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Flex"/>
  <button id="addFlexBtn" onclick="addFlexButton()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° Flex</button>

  <div id="flexButtons"></div>

  <hr/>

  <!-- Generator -->
  <input id="genInput" placeholder="‡∏ß‡∏≤‡∏á: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ LINE ID"/>
  <button id="genShareBtn" onclick="generateAndShare()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏£‡πå Flex üöÄ</button>
</div>

<script>
// ====== WHITELIST 2 ‡∏ä‡∏∑‡πà‡∏≠ ======
const whitelistUsers = [
  { name: "ü•Ä‚ö°üñ§‚û£‡ªÇ„ÅÆ·Äî·Äê’É‡∏±‡πà’Å¬π‚úØüñ§‚ö°ü•Ä", userId: "u72d702258991428344e77670bb76f80a" }
];

// ====== FLEX ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ) ======
const flex1 = {
  "type": "flex",
  "altText": "‡∏£‡∏±‡∏ö ‡πÇ‡∏û‡∏™ ‡πÅ‡∏ä‡∏£‡πå ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏£‡∏π‡∏õ",
  "contents": {
    "type": "bubble",
    "size": "giga",
    "body": {
      "type": "box",
      "layout": "vertical",
      "contents": [
        { "type": "text", "text": "‡∏£‡∏∞‡∏ö‡∏ö PYTHON  AUTOPOST", "color": "#ffffff", "wrap": true, "align": "center", "weight": "bold", "size": "xl" }
      ],
      "backgroundColor": "#000000"
    },
    "footer": { "type": "box", "layout": "vertical", "spacing": "sm", "backgroundColor": "#99ffff", "contents": [] }
  }
};

const flex2 = {
  "type": "flex",
  "altText": "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤",
  "contents": {
    "type": "bubble",
    "size": "giga",
    "hero": {
      "type": "image",
      "url": "https://img2.pic.in.th/IMG_0784.jpeg",
      "size": "full",
      "aspectRatio": "2:3",
      "aspectMode": "cover",
      "action": { "type": "uri", "uri": "http://line.me/ti/p/~mc357.com" },
      "backgroundColor": "#000000"
    },
    "footer": { "type": "box", "layout": "vertical", "spacing": "sm", "contents": [] }
  }
};

// ====== ‡πÄ‡∏Å‡πá‡∏ö Flex ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° ======
const userFlexMap = {};

// ====== init LIFF + ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ======
liff.init({ liffId: "2008621627-1eN2VA2x" })
.then(async()=>{
  const profile = await liff.getProfile();
  document.getElementById("username").innerText = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${profile.displayName} üòä`;

  const isAllowed = whitelistUsers.some(
    user => user.name === profile.displayName && user.userId === profile.userId
  );

  if(!isAllowed){
    // disable ‡∏ó‡∏∏‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå
    document.getElementById("btnFlex1").disabled = true;
    document.getElementById("btnFlex2").disabled = true;
    document.getElementById("genShareBtn").disabled = true;
    document.getElementById("addFlexBtn").disabled = true;
    document.getElementById("genShareBtn").innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô";
    document.getElementById("addFlexBtn").innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô";
  }
})
.catch(err=>{
  console.error(err);
  document.getElementById("username").innerText="‚ùå LIFF ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
});

// ====== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ä‡∏£‡πå Flex1 / Flex2 ======
async function shareFlex1(){
  if(!liff.isInClient()){alert("‚ö† ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE");return;}
  await liff.shareTargetPicker([flex1]);
}

async function shareFlex2(){
  if(!liff.isInClient()){alert("‚ö† ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE");return;}
  await liff.shareTargetPicker([flex2]);
}

// ====== ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå Flex ‡∏ï‡∏≤‡∏° userId (admin ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ) ======
function addFlexButton(){
  try{
    const flexJson = JSON.parse(document.getElementById("flexJsonInput").value);
    const userId = document.getElementById("flexUserIdInput").value.trim();

    userFlexMap[userId] = flexJson;

    const btn = document.createElement("button");
    btn.innerText = `‡πÅ‡∏ä‡∏£‡πå Flex (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ${userId})`;
    btn.onclick = async()=>{
      const profile = await liff.getProfile();
      const isAllowed = whitelistUsers.some(u=>u.userId===profile.userId && u.name===profile.displayName);
      if(!isAllowed){
        alert("‚õî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ä‡∏£‡πå");
        return;
      }
      await liff.shareTargetPicker([flexJson]);
    };

    document.getElementById("flexButtons").appendChild(btn);
    alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
  }catch(e){
    alert("‚ùå JSON ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
  }
}

// ====== Generator ‡πÅ‡∏ö‡∏ö 1 ‡∏ä‡πà‡∏≠‡∏á (‡∏ß‡∏≤‡∏á: ‡∏£‡∏π‡∏õ + ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ + LINE ID) ======
async function generateAndShare(){
  const input=document.getElementById("genInput").value.trim();
  if(!input.includes(" ")){alert("‚ö† ‡πÉ‡∏™‡πà: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ LINE ID");return;}
  const [img,id]=input.split(" ",2);

  const flex={
    "type":"flex","altText":"Generated Flex","contents":{
      "type":"carousel","contents":[
        {"type":"bubble","size":"giga","hero":{
          "type":"image","url":img,"size":"full","aspectRatio":"2:3","aspectMode":"cover",
          "action":{"type":"uri","uri":`http://line.me/ti/p/~${id}`},"backgroundColor":"#000000"},
        "footer":{"type":"button","style":"primary","action":{"type":"uri","label":"‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏Ñ‡∏•‡∏¥‡∏Å!!!","uri":`http://line.me/ti/p/~${id}`}}}
      ]
    }
  };

  const profile=await liff.getProfile();
  const isAllowed=whitelistUsers.some(u=>u.userId===profile.userId && u.name===profile.displayName);
  if(!isAllowed){alert("‚õî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ä‡∏£‡πå");return;}

  await liff.shareTargetPicker([flex]);
}
</script>

</body>
</html>